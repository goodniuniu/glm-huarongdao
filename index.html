<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åå®¹é“ - Huarongdao</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #1a1a2e 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #fff;
        }

        .game-container {
            text-align: center;
            padding: 20px;
        }

        h1 {
            margin-bottom: 30px;
            font-size: 2.5rem;
            color: #ecf0f1;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .game-board {
            width: 320px;
            height: 400px;
            background: rgba(44, 62, 80, 0.8);
            border: 3px solid #34495e;
            border-radius: 15px;
            margin: 0 auto;
            position: relative;
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
        }

        .block {
            position: absolute;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            border: 2px solid rgba(255,255,255,0.1);
        }

        .block:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
            border-color: rgba(255,255,255,0.2);
        }

        .block.selected {
            border-color: #f39c12;
            box-shadow: 0 0 20px rgba(243, 156, 18, 0.5);
            animation: pulse 1s infinite alternate;
        }

        @keyframes pulse {
            from {
                transform: scale(1);
            }
            to {
                transform: scale(1.02);
            }
        }

        .block.cao-cao {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .block.general {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }

        .block.horizontal-general {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
        }

        .block.soldier {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }

        .controls {
            margin-top: 30px;
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        button {
            padding: 12px 24px;
            background: rgba(52, 152, 219, 0.8);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        button:hover {
            background: rgba(52, 152, 219, 1);
            transform: translateY(-2px);
        }

        .victory-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .victory-content {
            background: linear-gradient(135deg, #2c3e50, #34995e);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }

        .victory-content h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: #f39c12;
        }

        .victory-content p {
            font-size: 1.2rem;
            margin-bottom: 30px;
        }

        .moves-counter {
            margin-top: 20px;
            font-size: 1.2rem;
            color: #ecf0f1;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>åå®¹é“</h1>
        <div class="game-board" id="gameBoard"></div>
        <div class="moves-counter">ç§»åŠ¨æ¬¡æ•°: <span id="moves">0</span></div>
        <div class="controls">
            <button onclick="resetGame()">é‡æ–°å¼€å§‹</button>
            <button onclick="showHint()">æç¤º</button>
        </div>
    </div>

    <div class="victory-modal" id="victoryModal">
        <div class="victory-content">
            <h2>ğŸ‰ èƒœåˆ©!</h2>
            <p>æ­å–œä½ æˆåŠŸå¸®åŠ©æ›¹æ“é€ƒå‡ºåå®¹é“!</p>
            <p>æ€»å…±ç”¨äº† <span id="finalMoves">0</span> æ­¥</p>
            <button onclick="resetGame()">å†ç©ä¸€æ¬¡</button>
        </div>
    </div>

    <script>
        const GRID_SIZE = 80;
        const BOARD_WIDTH = 4;
        const BOARD_HEIGHT = 5;

        let gameState = {
            blocks: [
                // æ›¹æ“ (2x2)
                { id: 'caocao', type: 'cao-cao', name: 'æ›¹æ“', x: 1, y: 0, width: 2, height: 2, color: '#e74c3c' },

                // æ­¦å°†ä»¬
                { id: 'zhangfei', type: 'general', name: 'å¼ é£', x: 0, y: 0, width: 1, height: 2, color: '#3498db' },
                { id: 'zhaoyun', type: 'general', name: 'èµµäº‘', x: 3, y: 0, width: 1, height: 2, color: '#3498db' },
                { id: 'machao', type: 'general', name: 'é©¬è¶…', x: 0, y: 2, width: 1, height: 2, color: '#3498db' },
                { id: 'huangzhong', type: 'general', name: 'é»„å¿ ', x: 3, y: 2, width: 1, height: 2, color: '#3498db' },
                { id: 'guanyu', type: 'horizontal-general', name: 'å…³ç¾½', x: 1, y: 2, width: 2, height: 1, color: '#9b59b6' },

                // å°å…µä»¬
                { id: 'soldier1', type: 'soldier', name: 'å…µ', x: 0, y: 4, width: 1, height: 1, color: '#2ecc71' },
                { id: 'soldier2', type: 'soldier', name: 'å…µ', x: 1, y: 3, width: 1, height: 1, color: '#2ecc71' },
                { id: 'soldier3', type: 'soldier', name: 'å…µ', x: 2, y: 3, width: 1, height: 1, color: '#2ecc71' },
                { id: 'soldier4', type: 'soldier', name: 'å…µ', x: 3, y: 4, width: 1, height: 1, color: '#2ecc71' }
            ],
            selectedBlock: null,
            moves: 0
        };

        function isPositionOccupied(x, y, excludeBlockId = null) {
            return gameState.blocks.some(block =>
                block.id !== excludeBlockId &&
                x >= block.x &&
                x < block.x + block.width &&
                y >= block.y &&
                y < block.y + block.height
            );
        }

        function canMoveTo(block, newX, newY) {
            // æ£€æŸ¥è¾¹ç•Œ
            if (newX < 0 || newY < 0 ||
                newX + block.width > BOARD_WIDTH ||
                newY + block.height > BOARD_HEIGHT) {
                return false;
            }

            // æ£€æŸ¥ç›®æ ‡ä½ç½®æ˜¯å¦è¢«å ç”¨
            for (let x = newX; x < newX + block.width; x++) {
                for (let y = newY; y < newY + block.height; y++) {
                    if (isPositionOccupied(x, y, block.id)) {
                        return false;
                    }
                }
            }

            return true;
        }

        function getPossibleMoves(block) {
            const moves = [];
            const directions = [
                { dx: 0, dy: -1, direction: 'up' },
                { dx: 0, dy: 1, direction: 'down' },
                { dx: -1, dy: 0, direction: 'left' },
                { dx: 1, dy: 0, direction: 'right' }
            ];

            for (const { dx, dy, direction } of directions) {
                const newX = block.x + dx;
                const newY = block.y + dy;

                if (canMoveTo(block, newX, newY)) {
                    moves.push({ x: newX, y: newY, direction });
                }
            }

            return moves;
        }

        function moveBlock(block, direction) {
            const moves = getPossibleMoves(block);
            const move = moves.find(m => m.direction === direction);

            if (move) {
                block.x = move.x;
                block.y = move.y;
                gameState.moves++;
                updateMovesDisplay();
                render();
                checkVictory();
                return true;
            }

            return false;
        }

        function handleBlockClick(blockId) {
            const block = gameState.blocks.find(b => b.id === blockId);

            if (gameState.selectedBlock === blockId) {
                // å¦‚æœç‚¹å‡»å·²é€‰ä¸­çš„å—ï¼Œå°è¯•å››ä¸ªæ–¹å‘ç§»åŠ¨
                const directions = ['up', 'down', 'left', 'right'];
                for (const direction of directions) {
                    if (moveBlock(block, direction)) {
                        break;
                    }
                }
                gameState.selectedBlock = null;
            } else {
                // é€‰ä¸­æ–°å—
                gameState.selectedBlock = blockId;
                render();
            }
        }

        function handleKeyPress(e) {
            if (!gameState.selectedBlock) return;

            const block = gameState.blocks.find(b => b.id === gameState.selectedBlock);
            if (!block) return;

            const directionMap = {
                'ArrowUp': 'up',
                'ArrowDown': 'down',
                'ArrowLeft': 'left',
                'ArrowRight': 'right'
            };

            const direction = directionMap[e.key];
            if (direction) {
                e.preventDefault();
                if (moveBlock(block, direction)) {
                    gameState.selectedBlock = null;
                }
            }
        }

        function render() {
            const board = document.getElementById('gameBoard');
            board.innerHTML = '';

            gameState.blocks.forEach(block => {
                const blockElement = document.createElement('div');
                blockElement.className = `block ${block.type}`;
                blockElement.style.left = `${block.x * GRID_SIZE}px`;
                blockElement.style.top = `${block.y * GRID_SIZE}px`;
                blockElement.style.width = `${block.width * GRID_SIZE - 10}px`;
                blockElement.style.height = `${block.height * GRID_SIZE - 10}px`;
                blockElement.style.background = `linear-gradient(135deg, ${block.color}, ${adjustColor(block.color, -20)})`;
                blockElement.textContent = block.name;
                blockElement.onclick = () => handleBlockClick(block.id);

                if (gameState.selectedBlock === block.id) {
                    blockElement.classList.add('selected');
                }

                board.appendChild(blockElement);
            });
        }

        function adjustColor(color, amount) {
            const hex = color.replace('#', '');
            const num = parseInt(hex, 16);
            const r = Math.max(0, Math.min(255, (num >> 16) + amount));
            const g = Math.max(0, Math.min(255, ((num >> 8) & 0x00FF) + amount));
            const b = Math.max(0, Math.min(255, (num & 0x0000FF) + amount));
            return `#${((r << 16) | (g << 8) | b).toString(16).padStart(6, '0')}`;
        }

        function checkVictory() {
            const caocao = gameState.blocks.find(b => b.id === 'caocao');
            if (caocao.x === 1 && caocao.y === 3) {
                setTimeout(() => {
                    document.getElementById('finalMoves').textContent = gameState.moves;
                    document.getElementById('victoryModal').style.display = 'flex';
                }, 300);
            }
        }

        function updateMovesDisplay() {
            document.getElementById('moves').textContent = gameState.moves;
        }

        function resetGame() {
            gameState.moves = 0;
            gameState.selectedBlock = null;
            gameState.blocks = [
                { id: 'caocao', type: 'cao-cao', name: 'æ›¹æ“', x: 1, y: 0, width: 2, height: 2, color: '#e74c3c' },
                { id: 'zhangfei', type: 'general', name: 'å¼ é£', x: 0, y: 0, width: 1, height: 2, color: '#3498db' },
                { id: 'zhaoyun', type: 'general', name: 'èµµäº‘', x: 3, y: 0, width: 1, height: 2, color: '#3498db' },
                { id: 'machao', type: 'general', name: 'é©¬è¶…', x: 0, y: 2, width: 1, height: 2, color: '#3498db' },
                { id: 'huangzhong', type: 'general', name: 'é»„å¿ ', x: 3, y: 2, width: 1, height: 2, color: '#3498db' },
                { id: 'guanyu', type: 'horizontal-general', name: 'å…³ç¾½', x: 1, y: 2, width: 2, height: 1, color: '#9b59b6' },
                { id: 'soldier1', type: 'soldier', name: 'å…µ', x: 0, y: 4, width: 1, height: 1, color: '#2ecc71' },
                { id: 'soldier2', type: 'soldier', name: 'å…µ', x: 1, y: 3, width: 1, height: 1, color: '#2ecc71' },
                { id: 'soldier3', type: 'soldier', name: 'å…µ', x: 2, y: 3, width: 1, height: 1, color: '#2ecc71' },
                { id: 'soldier4', type: 'soldier', name: 'å…µ', x: 3, y: 4, width: 1, height: 1, color: '#2ecc71' }
            ];
            document.getElementById('victoryModal').style.display = 'none';
            updateMovesDisplay();
            render();
        }

        function showHint() {
            alert('æç¤ºï¼šç‚¹å‡»ä¸€ä¸ªæ»‘å—é€‰ä¸­å®ƒï¼Œç„¶åç‚¹å‡»æ–¹å‘é”®æˆ–å†æ¬¡ç‚¹å‡»æ»‘å—æ¥ç§»åŠ¨ã€‚ç›®æ ‡æ˜¯æŠŠæ›¹æ“ï¼ˆçº¢è‰²å¤§æ–¹å—ï¼‰ç§»åˆ°åº•éƒ¨ä¸­é—´ä½ç½®ã€‚');
        }

        // é”®ç›˜äº‹ä»¶ç›‘å¬
        document.addEventListener('keydown', handleKeyPress);

        // åˆå§‹åŒ–æ¸¸æˆ
        render();
    </script>
</body>
</html>